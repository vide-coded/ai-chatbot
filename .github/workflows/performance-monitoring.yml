### 4. Performance Monitoring Workflow

### File: .github/workflows/performance-monitoring.yml

name: Performance Monitoring

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]
  schedule:
    - cron: '0 0 * * *' # Run daily at midnight

jobs:
  performance-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Bun
        uses: oven-sh/setup-bun@v1
        
      - name: Install dependencies
        run: bun install
        
      - name: Build project
        run: bun run build
        
      - name: Run performance tests
        run: |
          # Run Lighthouse CI
          npx lighthouse-ci --config=lighthouserc.json
          
          # Run custom performance tests
          bun run performance-test
        
      - name: Upload performance report
        uses: actions/upload-artifact@v3
        with:
          name: performance-report
          path: performance-report.json
        
      - name: Compare with baseline
        run: |
          # Compare current performance with baseline
          node scripts/compare-performance.js
          
      - name: Create performance alert
        if: failure()
        uses: actions/github-script@v6
        with:
          script: |
            const { data: comments } = await github.rest.issues.listComments({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number
            });
            
            const performanceAlert = `⚠️ **Performance Alert**

Performance regression detected:
- **Metric**: ${process.env.PERF_METRIC}
- **Current**: ${process.env.PERF_CURRENT}
- **Baseline**: ${process.env.PERF_BASELINE}
- **Regression**: ${process.env.PERF_REGRESSION}%

Please investigate and optimize.`;
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: performanceAlert
            });

  performance-dashboard:
    needs: performance-test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/download-artifact@v3
        with:
          name: performance-report
          
      - name: Update performance dashboard
        run: |
          # Update performance metrics in dashboard
          node scripts/update-dashboard.js
          
      - name: Commit dashboard update
        run: |
          git config --global user.name "Performance Bot"
          git config --global user.email "performance@bot.com"
          git add performance-dashboard.md
          git commit -m "chore: update performance dashboard"
          git push

  notify-slack:
    needs: performance-test
    if: always()
    runs-on: ubuntu-latest
    steps:
      - name: Send Slack notification
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
          SLACK_COLOR: ${{ job.status }}
          SLACK_TITLE: "Performance Monitoring"
          SLACK_MESSAGE: "Performance test completed with status: ${{ job.status }}"
          SLACK_FOOTER: "Performance Dashboard"

# Example Lighthouse CI configuration
# File: lighthouserc.json
{
  "ci": {
    "collect": {
      "url": ["http://localhost:3000"],
      "startServerCommand": "bun run start",
      "numberOfRuns": 3
    },
    "assert": {
      "preset": "lighthouse:recommended",
      "assertions": {
        "categories:performance": ["error", {"minScore": 0.9}],
        "categories:accessibility": ["error", {"minScore": 0.9}],
        "categories:best-practices": ["error", {"minScore": 0.9}],
        "categories:seo": ["error", {"minScore": 0.9}]
      }
    },
    "upload": {
      "target": "temporary-public-storage"
    }
  }
}